---
layout: default
title: "Escape Rooms in meiner NÃ¤he finden: Die interaktive Test-Karte"
permalink: /karte/
---
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

<style>
    .closed-stamp {
        background-color: #d32f2f;
        color: white;
        padding: 4px 8px;
        font-weight: bold;
        text-transform: uppercase;
        font-size: 0.8rem;
        letter-spacing: 1px;
        border: 1px solid rgba(255,255,255,0.3);
    }

    /* --- DATENSCHUTZ / 2-KLICK-LÃ–SUNG STYLES --- */
    .osm-placeholder {
        width: 100%;
        height: 500px; /* Sollte der HÃ¶he deiner Map entsprechen */
        background-color: #2c2c2c;
        background-image: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%233a3a3a' fill-opacity='0.4' fill-rule='evenodd'%3E%3Cpath d='M0 40L40 0H20L0 20M40 40V20L20 40'/%3E%3C/g%3E%3C/svg%3E");
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        border: 1px solid #444;
        color: #fff;
        font-family: sans-serif;
        position: relative;
        border-radius: 4px;
    }

    .osm-content {
        padding: 20px;
        max-width: 450px;
        background: rgba(0, 0, 0, 0.6);
        border: 1px solid #555;
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.5);
    }

    .osm-content h3 {
        margin-top: 0;
        text-transform: uppercase;
        letter-spacing: 2px;
        font-size: 1.2rem;
        color: #f0f0f0;
    }

    .osm-content p {
        font-size: 0.9rem;
        color: #ccc;
        margin-bottom: 20px;
        line-height: 1.5;
    }

    .osm-button {
        background-color: #d9534f;
        color: white;
        border: none;
        padding: 12px 24px;
        font-size: 1rem;
        cursor: pointer;
        text-transform: uppercase;
        font-weight: bold;
        border-radius: 4px;
        transition: all 0.3s ease;
        letter-spacing: 1px;
    }

    .osm-button:hover {
        background-color: #c9302c;
        transform: scale(1.05);
        box-shadow: 0 0 10px rgba(217, 83, 79, 0.5);
    }
</style>

<section class="map-section">
    <h2 class="section-title">Einsatzorte</h2>
    
    <div id="osm-wrapper" class="osm-placeholder">
        <div class="osm-content">
            <h3>ðŸ”’ Einsatzkarte verschlÃ¼sselt</h3>
            <p>
                Aus DatenschutzgrÃ¼nden wird die Karte von <strong>OpenStreetMap</strong> erst geladen, wenn Sie zustimmen.
                Dabei werden Ihre IP-Adresse und Nutzungsdaten an die Server von OpenStreetMap Ã¼bertragen.
            </p>
            <button id="load-map-btn" class="osm-button">Karte aktivieren</button>
        </div>
    </div>

    <div id="escapeMap" class="grunge-map" style="display: none; height: 500px; width: 100%;"></div>

</section>

<hr style="border: 0; margin: 1rem 0;">

<section class="archive-section">
    <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap;">
        <div class="sort-controls" style="margin-top: 1rem;">
            <span style="color:#888; margin-right:10px; text-transform:uppercase; font-size:0.8rem;">Sortieren nach:</span>
            <button class="btn-sort" onclick="sortRooms('name')">Name</button>
            <button class="btn-sort" onclick="sortRooms('provider')">Anbieter</button>
            <button class="btn-sort" onclick="sortRooms('rating')">Bewertung</button>
        </div>
    </div>
    
    <br>

    <div class="card-grid" id="roomGrid">
        {% for review in site.reviews %}
        
        {% assign r = review.ratings %}
        {% assign sum = r.atmosphere.score | plus: r.story.score | plus: r.puzzles.score | plus: r.scenery.score | plus: r.gamemaster.score %}
        {% assign calculated_avg = sum | divided_by: 5.0 %}

        <a href="{{ review.url }}" class="room-card-link"
           data-title="{{ review.title | downcase }}"
           data-provider="{{ review.provider | downcase }}"
           data-lat="{{ review.location.lat }}"
           data-lng="{{ review.location.lng }}"
           data-rating="{% if review.pending or review.planned %}-1{% else %}{{ calculated_avg }}{% endif %}">
            
            <article class="room-card">
                <div class="card-image-wrapper">
                    {% if review.thumbnail %}
                        {% assign img_src = review.thumbnail %}
                    {% elsif review.images.size > 0 %}
                        {% assign img_src = review.images[0] %}
                    {% else %}
                        {% assign img_src = "ui/no-signal.jpg" %}
                    {% endif %}

                    <img
                        src="/assets/images/{{ img_src }}"
                        alt="{{ review.title }}"
                        {% if forloop.first %} loading="eager" fetchpriority="high" {% else %} loading="lazy" {% endif %}
                        width="400"
                        height="200"
                        style="object-fit: cover; {% if review.closed %}filter: grayscale(100%);{% endif %}"
                    >
                    
                    {% if review.closed %}
                        <div class="pending-overlay">
                            <span class="closed-stamp">AKTE GESCHLOSSEN</span>
                        </div>
                    {% endif %}
                    
                    {% if review.planned %}
                        <div class="pending-overlay">
                            <span class="planned-stamp">EINSATZ GEPLANT</span>
                        </div>
                    {% elsif review.pending %}
                        <div class="pending-overlay">
                            <span class="pending-stamp">ERMITTLUNG LÃ„UFT</span>
                        </div>

                    {% else %}
                        <div class="rating-badge">
                            â˜… {{ calculated_avg | round: 1 }}
                        </div>
                    {% endif %}
                </div>

                <div class="card-content">
                    <h3>
                        {{ review.title }}
                        {% if review.closed %}
                            <span style="color: #d32f2f; font-size: 0.7em;">[INAKTIV]</span>
                        {% endif %}
                    </h3>
                    <p class="card-meta">{{ review.provider }} | {{ review.location.city }}</p>
                    
                    {% if review.closed %}
                         <div style="margin: 10px 0; color: #d32f2f; font-size: 0.9rem; font-family: 'Courier New'; font-weight: bold;">
                            [NICHT MEHR BUCHBAR]
                        </div>
                    {% elsif review.planned %}
                        <div style="margin: 10px 0; color: #1E88E5; font-size: 0.9rem; font-family: 'Courier New'; font-weight: bold;">
                            [Termin: {{ review.visit_date | date: "%d.%m.%Y" }}]
                        </div>
                    {% elsif review.pending %}
                        <div style="margin: 10px 0; color: #888; font-size: 0.9rem; font-family: 'Courier New';">
                            [Daten werden noch ausgewertet...]
                        </div>
                    {% endif %}

                    {% unless review.planned or review.pending %}
                        <div class="stars small" style="--score: {{ calculated_avg }};">â˜…â˜…â˜…â˜…â˜…</div>
                    {% endunless %}
                    
                    <p class="card-summary">{{ review.summary | truncate: 100, "..." }}</p>
                </div>
            </article>
        </a>
        {% endfor %}
    </div>
</section>

<script>
    var roomData = [
        {% for review in site.reviews %}
        
        {% assign r = review.ratings %}
        {% assign sum = r.atmosphere.score | plus: r.story.score | plus: r.puzzles.score | plus: r.scenery.score | plus: r.gamemaster.score %}
        {% assign calculated_avg = sum | divided_by: 5.0 %}

        {
            "title": "{{ review.title }}",
            "url": "{{ review.url }}",
            "lat": {{ review.location.lat }},
            "lng": {{ review.location.lng }},
            "rating": {{ calculated_avg }},
            "provider": "{{ review.provider }}",
            "pending": {{ review.pending | default: false }},
            "planned": {{ review.planned | default: false }},
            "closed": {{ review.closed | default: false }}
        }{% unless forloop.last %},{% endunless %}
        {% endfor %}
    ];
</script>

<script>
document.getElementById('load-map-btn').addEventListener('click', function() {
    var placeholder = document.getElementById('osm-wrapper');
    var mapDiv = document.getElementById('escapeMap');

    // 1. Platzhalter ausblenden
    placeholder.style.display = 'none';
    
    // 2. Karten-Div sichtbar machen
    mapDiv.style.display = 'block';

    // 3. Map-Script (Leaflet Logik) dynamisch nachladen
    var script = document.createElement('script');
    script.src = "/assets/js/map.js";
    script.onload = function() {
        // Falls Leaflet ein Resize-Event braucht, weil der Container vorher unsichtbar war
        if (typeof map !== 'undefined') {
            map.invalidateSize();
        }
    };
    document.body.appendChild(script);
});
</script>
